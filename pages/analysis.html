<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>วิเคราะห์ | สวนทุเรียน</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body onload="guard(); render();">
<nav class="navbar navbar-dark bg-success">
  <div class="container-fluid">
    <a class="navbar-brand" href="dashboard.html">← แดชบอร์ด</a>
    <span class="navbar-text">วิเคราะห์ต้นทุน</span>
  </div>
</nav>

<div class="container py-4">
  <div class="row g-3">
    <div class="col-md-6">
      <div class="card p-3 shadow-sm">
        <h5>ต้นทุนวัตถุดิบ (จากคลัง)</h5>
        <div id="costInv" class="display-6"></div>
        <div class="text-muted small">คำนวณจากราคา/หน่วย x จำนวนคงเหลือ (เพื่อประเมินมูลค่าในมือ)</div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card p-3 shadow-sm">
        <h5>จำนวนงานในปฏิทิน (เดือนนี้)</h5>
        <div id="taskCount" class="display-6"></div>
        <div class="text-muted small">ใช้ดูภาระงานช่วงเดือน</div>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== include app.js (ย่อ) ===== */
</script>
<script>
function render(){
  const inv = LS.get("inventory", []);
  const total = inv.reduce((s,x)=> s + (num(x.price)*num(x.qty)), 0);
  document.getElementById('costInv').innerText = total.toLocaleString() + " บาท";

  const m = new Date().toISOString().slice(0,7); // YYYY-MM
  const tasks = LS.get("tasks", []).filter(t => (t.date||"").startsWith(m));
  document.getElementById('taskCount').innerText = tasks.length;
}
</script>
</body>
</html>
